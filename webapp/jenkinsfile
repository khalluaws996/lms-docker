pipeline {
    agent any

    environment {
        artifactURL = "http://54.172.190.173:8081/artifact.zip"
        downloadDirectory = "/tmp"
        deploymentDirectory = "/opt/lms"
    }

    stages {
        stage('Cleanup Workspace') {
            steps {
                deleteDir()
            }
        }
        
        stage('Download Artifact') {
            steps {
                echo 'Downloading artifact...'
                sh "wget ${env.artifactURL} -P ${env.downloadDirectory}"
            }
        }
        
        stage('Deploy LMS') {
            steps {
                echo 'Deploying LMS...'
                sh "unzip ${env.downloadDirectory}/artifact.zip -d ${env.deploymentDirectory}"
                sh "${env.deploymentDirectory}/start.sh"
            }
        }
    }
    
    post {
        always {
            // Clean up any temporary files or resources if needed
            cleanWs()
        }
    }
}
